<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>yurunfeng.cn/path - 时间记录与路径管理系统</title>
    <script src="./echarts.min.js"></script>
    <style>
        #chart-container {
            width: 100%;
            height: 300px;
            margin: 0 auto;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }

        .idle-time {
            background-color: lightgreen;
        }

        .hidden {
            display: none;
        }

        /* 默认的侧边栏样式 */
        #sidebar {
            position: fixed;
            left: -200px;
            /* 默认隐藏 */
            top: 0;
            height: 100%;
            width: 200px;
            /* 默认宽度 */
            background-color: #333;
            padding-top: 20px;
            color: #fff;
            transition: left 0.3s;
            /* 添加过渡效果 */
            z-index: 999;
            /* 确保在顶部 */
        }

        #sidebar ul {
            list-style-type: none;
            padding: 0;
            margin-top: 25px;
        }

        #sidebar ul li {
            padding: 10px;
        }

        #sidebar ul li a {
            color: #fff;
            text-decoration: none;
        }

        #sidebar ul li a:hover {
            /* 添加鼠标悬停样式 */
            background-color: #555;
        }

        #sidebar ul li.active a {
            /* 添加选中样式 */
            background-color: #555;
        }

        #menuButton {
            position: fixed;
            left: 20px;
            top: 20px;
            z-index: 1000;
            cursor: pointer;
            color: #fff;
            font-size: 12px;
            background-color: #333;
            width: 20px;
            /* 调整按钮的宽度 */
            height: 15px;
            /* 调整按钮的高度 */
            line-height: 15px;
            /* 设置行高等于按钮高度 */
            padding: 0;
            /* 移除内边距 */
            border: 2px solid #fff;
            border-radius: 5px;
            text-align: center;
            /* 文本居中 */
        }

        /* 避免导航按钮和侧边栏文字重叠 */
        #sidebar ul li {
            padding-left: 20px;
            display: block;
            /* 让背景颜色占满整个侧边栏宽度 */
            height: 30px;
            /* 设置背景颜色的高度 */
            line-height: 30px;
        }

        /* 添加一个新的类名来设置选中状态的样式 */
        .active {
            background-color: #555;
        }

        .way-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .way {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .way-details {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-top: 10px;
        }

        .way-details-item {
            width: 48%;
        }

        .way-type {
            font-weight: bold;
            color: #333;
        }

        .way-time {
            color: #666;
        }

        .add-button {
            background-color: #4caf50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
        }

        .add-button:hover {
            background-color: #45a049;
        }

        .modal {
            display: none;
            /* 默认隐藏 */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            /* 滚动条 */
            background-color: rgb(0, 0, 0);
            /* 黑色背景，稍加透明度 */
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            /* 白色背景 */
            margin: 15% auto;
            /* 在页面顶部垂直居中 */
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            /* 窗口宽度 */
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        /* 添加一个新的类名来隐藏字段 */
        .hidden-field {
            display: none;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .modal:not(.hidden) {
            display: block;
        }

        /* 添加不同语义的背景颜色 */
        .free-time {
            background-color: #e6e6e6;
            /* 灰色 */
        }

        .wait-time {
            background-color: #ffcc66;
            /* 橙黄色 */
        }

        .foot-time {
            background-color: #66cc99;
            /* 浅绿色 */
        }

        .getup-time {
            background-color: #99ccff;
            /* 浅蓝色 */
        }

        .eat-time {
            background-color: #ff9999;
            /* 浅红色 */
        }

        .main-time {
            background-color: #ffff66;
            /* 浅黄色 */
        }

        .time-row {
            background-color: #f0f0f0;
            /* 淡灰色 */
        }

        .edit-button,
        .delete-button {
            background-color: #4caf50;
            /* 绿色 */
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            transition-duration: 0.4s;
            cursor: pointer;
            border-radius: 4px;
            /* 添加圆角 */
        }

        .edit-button:hover,
        .delete-button:hover {
            background-color: #45a049;
            /* 深绿色 */
        }

        .delete-button {
            background-color: #f44336;
            /* 红色 */
        }

        .delete-button:hover {
            background-color: #d32f2f;
            /* 深红色 */
        }

        /* 修改配置界面样式 */
        #configForm {
            background-color: #f5f5f5;
            /* 背景色 */
            padding: 20px;
            /* 内边距 */
            border-radius: 8px;
            /* 圆角 */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            /* 阴影效果 */
        }

        .config-field {
            margin-bottom: 10px;
            /* 底部间距 */
        }

        .config-label {
            font-weight: bold;
            /* 加粗 */
        }

        .config-input {
            width: calc(100% - 16px);
            /* 宽度 */
            padding: 8px;
            /* 内边距 */
            border: 1px solid #ccc;
            /* 边框 */
            border-radius: 4px;
            /* 圆角 */
        }

        .save-button {
            background-color: #007bff;
            /* 蓝色 */
            color: #fff;
            /* 白色 */
            border: none;
            /* 无边框 */
            padding: 10px 20px;
            /* 内边距 */
            border-radius: 4px;
            /* 圆角 */
            cursor: pointer;
            /* 鼠标指针 */
            transition: background-color 0.3s ease;
            /* 过渡效果 */
        }

        .save-button:hover {
            background-color: #0056b3;
            /* 深蓝色 */
        }

        #dataManagement {
            margin-top: 20px;
        }

        .export-button {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
        }

        .export-button:hover {
            background-color: #45a049;
        }

        .import-label {
            font-size: 16px;
            margin-left: 20px;
        }

        #updateLog {
            margin-top: 20px;
        }

        #updateLog h2 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .update-item {
            margin-bottom: 10px;
        }

        .update-date {
            font-weight: bold;
            color: #666;
            margin-right: 10px;
        }

        .image-container {
            width: 100%;
        }

        .image-container img {
            width: auto;
            height: 300px;
        }

        table {
            width: 100%;
        }

        /* 在手机端设置侧边栏的宽度 */
        @media screen and (max-width: 768px) {
            #sidebar {
                width: 100px;
                /* 在手机端设置较小的宽度 */
            }

            #sidebar ul li {
                text-align: center;
                padding-left: 0;
            }

            .image-container img {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>

<body>
    <!-- 菜单按钮 -->
    <div id="menuButton" onclick="toggleActive()">&#9776;</div>
    <!-- 侧边导航栏 -->
    <nav id="sidebar">
        <ul>
            <li class="active"><a href="#" id="tableLink" onclick="setActive(this)">表格视图</a></li>
            <!-- 在侧边栏新增开发者模式选项 -->
            <li><a href="#" id="devLink" onclick="setActive(this)">开发者模式</a></li>
            <li><a href="#" id="formLink" onclick="setActive(this)">修改界面</a></li>
            <li><a href="#" id="configLink" onclick="setActive(this)">修改配置</a></li>
            <li><a href="#" id="dataLink" onclick="setActive(this)">数据管理</a></li>
            <li><a href="#" id="logLink" onclick="setActive(this)">更新日志</a></li>
            <li><a href="#" id="supportLink" onclick="setActive(this)">支持作者</a></li>
        </ul>
    </nav>
    <!-- 新增开发者模式界面 -->
    <div id="developerContent" class="hidden" style="padding:20px;">
        <h2>开发者模式</h2>
        <textarea id="devTextarea" style="width:100%; height:300px;"></textarea>
        <br />
        <button id="devSaveButton" class="save-button" style="margin-top:10px;">保存</button>
    </div>
    <div id="supportAuthor" class="hidden">
        <div class="app-container">
            <div class="row justify-center align-middle">
                <h2>打赏创作者</h2>
            </div>
            <div class="row justify-center" style="margin-left: -10px; margin-right: -10px">
                <div class="col-12 guttered"
                    style="padding-right: 10px; padding-left: 10px; display: flex; justify-content: center; align-items: center">
                    <div class="image-container" style="width: 100%">
                        <img src="./pay.png" class="image-inner" />
                    </div>
                </div>
                <div class="col-12 guttered" style="padding-right: 10px; padding-left: 10px">
                    <div class="card">
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th class="column">昵称</th>
                                        <th class="column">金额</th>
                                        <th class="column">留言</th>
                                        <th class="column">反馈</th>
                                    </tr>
                                </thead>
                                <tbody id="supportAuthorTableBody">
                                    <!-- JavaScript will dynamically generate rows here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="updateLog" class="hidden">
        <!-- <h2>更新日志</h2> -->
        <div id="updateLogContent"></div>
    </div>
    <!-- 原始表格内容 -->
    <div id="tableContent">
        <table>
            <thead>
                <tr>
                    <th>类型</th>
                    <th>路径</th>
                    <th>出发时间</th>
                    <th>到达时间</th>
                    <th>历时</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- 表格内容将在此动态生成 -->
            </tbody>
        </table>
        <div id="chart-container"></div>
    </div>
    <!-- 新增的修改界面 -->
    <div id="formContent" class="hidden">
        <div class="way-container">
            <!-- JavaScript 会动态添加路径图 -->
        </div>
    </div>
    <!-- 新增配置修改界面 -->
    <div id="configContent" class="hidden">
        <h2>修改配置</h2>
        <form id="configForm"></form>
    </div>
    <!-- 新增窗口 -->
    <div id="addModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>新增路径</h2>
            <form id="addForm">
                <label for="type">类型：</label>
                <select id="type" onchange="updateUI()">
                    <option value="foot">步行</option>
                    <option value="bus">公交车</option>
                    <option value="railway">火车</option>
                    <option value="main">主要活动</option>
                    <!-- 添加更多类型 -->
                </select>
                <br />
                <div id="fromField" class="form-field">
                    <label for="from">出发地：</label>
                    <input type="text" id="from" />
                </div>
                <div id="toField" class="form-field">
                    <label for="to">目的地：</label>
                    <input type="text" id="to" />
                </div>
                <div id="mField" class="form-field">
                    <label for="m">耗时（分钟）：</label>
                    <input type="number" id="m" />
                </div>
                <div id="startFields" class="hidden-field">
                    <!-- 公交车的发车时间字段 -->
                    <label>发车时间：</label>
                    <div id="startInputs">
                        <!-- 第一个发车时间输入框 -->
                        <input type="time" class="start-time" />
                    </div>
                    <button type="button" onclick="addStartTime()">添加更多</button>
                </div>
                <div id="wayFields" class="hidden-field">
                    <!-- 火车的途径时间字段 -->
                    <label>途径时间：</label>
                    <div id="wayInputs">
                        <!-- 第一个途径时间输入框 -->
                        <input type="time" class="way-time" />
                        <span> - </span>
                        <input type="time" class="way-time" />
                    </div>
                    <button type="button" onclick="addWayTime()">添加更多</button>
                </div>
                <div id="additionalFields" class="hidden-field">
                    <!-- 主要活动的额外字段 -->
                    <label for="name">名称：</label>
                    <input type="text" id="name" />
                    <br />
                    <label for="startTime">开始时间：</label>
                    <input type="time" id="startTime" />
                    <br />
                    <label for="endTime">结束时间：</label>
                    <input type="time" id="endTime" />
                    <br />
                </div>
                <input type="submit" value="新增" />
            </form>
        </div>
    </div>
    <!-- 编辑窗口 -->
    <div id="editModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>编辑路径</h2>
            <form id="editForm">
                <label for="editType">类型：</label>
                <select id="editType" onchange="updateEditUI()">
                    <option value="foot">步行</option>
                    <option value="bus">公交车</option>
                    <option value="railway">火车</option>
                    <option value="main">主要活动</option>
                    <!-- 添加更多类型 -->
                </select>
                <br />
                <div id="editFromField" class="form-field">
                    <label for="editFrom">出发地：</label>
                    <input type="text" id="editFrom" />
                </div>
                <div id="editToField" class="form-field">
                    <label for="editTo">目的地：</label>
                    <input type="text" id="editTo" />
                </div>
                <div id="editMField" class="form-field">
                    <label for="editM">耗时（分钟）：</label>
                    <input type="number" id="editM" />
                </div>
                <div id="editStartFields" class="hidden-field">
                    <!-- 公交车的发车时间字段 -->
                    <label>发车时间：</label>
                    <div id="editStartInputs">
                        <!-- 第一个发车时间输入框 -->
                        <input type="time" class="edit-start-time" />
                    </div>
                    <button type="button" onclick="addEditStartTime()">添加更多</button>
                </div>
                <div id="editWayFields" class="hidden-field">
                    <!-- 火车的途径时间字段 -->
                    <label>途径时间：</label>
                    <div id="editWayInputs">
                        <!-- 第一个途径时间输入框 -->
                        <div class="way-input-container">
                            <input type="time" class="edit-way-time" />
                            <span> - </span>
                            <input type="time" class="edit-way-time" />
                            <button type="button" class="delete-button" onclick="deleteWayTime(0)">删除</button>
                        </div>
                    </div>
                    <button type="button" onclick="addEditWayTime()">添加更多</button>
                </div>
                <div id="editAdditionalFields" class="hidden-field">
                    <!-- 主要活动的额外字段 -->
                    <label for="editName">名称：</label>
                    <input type="text" id="editName" />
                    <br />
                    <label for="editStartTime">开始时间：</label>
                    <input type="time" id="editStartTime" />
                    <br />
                    <label for="editEndTime">结束时间：</label>
                    <input type="time" id="editEndTime" />
                    <br />
                </div>
                <input type="submit" value="保存" />
            </form>
        </div>
    </div>
    <div id="dataManagement" class="hidden">
        <button class="export-button" onclick="exportData()">导出数据</button>
        <label for="importFile" class="import-label">选择JSON文件：</label>
        <input type="file" id="importFile" accept=".json" onchange="importData(event)" />
    </div>

    <script type="text/javascript" src="./xjt.js"></script>
    <script>
        const tableBody = document.getElementById('tableBody')
        const wayContainer = document.querySelector('.way-container')

        // 当点击开发者模式选项时，将当前的 ways 数据填入 textarea
        document.getElementById('devLink').addEventListener('click', function () {
            document.getElementById('devTextarea').value = JSON.stringify(ways, null, 2);
        });

        // 点击保存按钮时解析 textarea 内容并更新 ways，然后调用 refresh()
        document.getElementById('devSaveButton').addEventListener('click', function () {
            try {
                ways = JSON.parse(document.getElementById('devTextarea').value);
                refresh();
                alert('开发者数据保存成功！');
            } catch (error) {
                alert('JSON 格式错误，请检查数据格式。');
            }
        });
        // 修改渲染表格的函数
        function renderTable() {
            const tableBody = document.getElementById('tableBody')
            tableBody.innerHTML = ''

            updatedPaths.forEach((item, index) => {
                const row = document.createElement('tr')
                row.setAttribute('data-index', index) // 添加行的唯一标识符

                // 设置type列的背景颜色
                const typeCell = document.createElement('td')
                typeCell.textContent = item.type
                if (item.type === 'bus' || item.type === 'railway') {
                    row.classList.add('idle-time')
                    row.style.cursor = 'pointer' // 添加pointer鼠标
                } else if (item.type === 'free') {
                    typeCell.classList.add('free-time')
                } else if (item.type === 'wait') {
                    typeCell.classList.add('wait-time')
                } else if (item.type === 'foot') {
                    typeCell.classList.add('foot-time')
                } else if (item.type === 'getup') {
                    typeCell.classList.add('getup-time')
                } else if (item.type === 'eat') {
                    typeCell.classList.add('eat-time')
                } else if (item.type === 'main') {
                    typeCell.classList.add('main-time')
                }
                row.appendChild(typeCell)

                row.innerHTML += `
                  <td>${item.path}</td>
                  <td>${item.go}</td>
                  <td>${item.arrive}</td>
                  <td>${item.past}</td>
              `

                tableBody.appendChild(row)

                // 添加点击事件监听器
                row.addEventListener('click', () => {
                    toggleTimeDisplay(row)
                })
            })
        }

        renderTable()
        // 切换时间显示状态的函数
        function toggleTimeDisplay(row) {
            const route = row.children[1].textContent.split('-') // 获取当前行的出发地和目的地

            // 如果路线长度不为2，则返回，因为无法确定出发地和目的地
            if (route.length !== 2) {
                return
            }

            const from = route[0].trim() // 出发地
            const to = route[1].trim() // 目的地

            // 根据出发地和目的地找到对应的项
            const item = ways.find((way) => way.from === from && way.to === to)
            const type = item.type
            if (type !== 'bus' && type !== 'railway') return

            // 如果找到对应的项，则获取发车时间或途径时间
            if (item) {
                const startTime = item.start && item.start.join(', ')
                const wayTimes = item.way && item.way.map((time) => `${time.start} - ${time.end}`).join(', ')

                // 显示所有的发车时间或途径时间
                const allTimes = startTime || wayTimes || ''

                // 创建一个新的行来显示所有时间
                const timeRow = document.createElement('tr')
                const timeCell = document.createElement('td')
                timeCell.colSpan = 5 // 横跨整个表格的列
                timeCell.textContent = `时间：${allTimes}`
                timeRow.appendChild(timeCell)

                // 检查是否已经显示时间，如果是，则移除时间行，否则添加时间行到表格
                if (row.classList.contains('show-time')) {
                    row.classList.remove('show-time')
                    if (row.nextSibling && row.nextSibling.classList.contains('time-row')) {
                        row.nextSibling.remove()
                    }
                } else {
                    row.classList.add('show-time')
                    timeRow.classList.add('time-row')
                    row.insertAdjacentElement('afterend', timeRow)
                }
            }
        }
        // 函数用于重新渲染路线图
        function renderWayContainer() {
            // 清空原有内容
            wayContainer.innerHTML = ''

            // 遍历每个路线，创建对应的 div 元素并添加到 wayContainer 中
            ways.forEach((way, i) => {
                const wayElement = document.createElement('div')
                wayElement.classList.add('way')

                let detailsHTML
                if (way.type !== 'main') {
                    detailsHTML = `
          <div class="way-type">${way.type}</div>
          <div>从 ${way.from} 到 ${way.to}</div>
        `
                } else {
                    detailsHTML = `
          <div class="way-type">${way.type}</div>
          <div>${way.name}</div>
          <div>开始时间：${way.start}</div>
          <div>结束时间：${way.end}</div>
        `
                }
                // 添加到达后是否吃饭的复选框选项
                detailsHTML += `
        <div>
          <label for="eat-${i}">到达后是否吃饭：</label>
          <input type="checkbox" id="eat-${i}" ${way.eat ? 'checked' : ''} onchange="updateEat(${i}, this.checked)">
        </div>
      `
                if (way.m) {
                    detailsHTML += `<div class="way-details-item">耗时：${way.m} 分钟</div>`
                }

                if (way.start && way.type !== 'main') {
                    detailsHTML += `<div class="way-details-item">发车时间：`
                    if (Array.isArray(way.start)) {
                        detailsHTML += `${way.start.join(', ')}`
                    } else {
                        detailsHTML += `${way.start}`
                    }
                    detailsHTML += `</div>`
                }

                if (way.way) {
                    detailsHTML += `<div class="way-details-item">途经时间：`
                    way.way.forEach((time) => {
                        detailsHTML += `<div class="way-time">从 ${time.start} 到 ${time.end}</div>`
                    })
                    detailsHTML += `</div>`
                }
                // 在显示路线详情信息的地方，添加最迟到达时间的输入框
                detailsHTML += `
        <div>
          <label for="mustbeentime-${i}">最迟到达时间：</label>
          <input type="time" id="mustbeentime-${i}" value="${way.mustbeentime || ''
                    }" onchange="updateMustBeEntime(${i}, this.value)">
        </div>
      `

                // 添加修改按钮
                detailsHTML += `
                  <button class="edit-button" onclick="editWay(${i})">修改</button>
              `
                // 添加删除按钮
                detailsHTML += `
              <button class="delete-button" onclick="deleteWay(${i})">删除</button>
          `
                wayElement.innerHTML = detailsHTML
                wayContainer.appendChild(wayElement)

                // 在每个路线后面插入新增按钮，除非是最后一个路线
                if (i < ways.length) {
                    const addButton = document.createElement('button')
                    addButton.textContent = '新增'
                    addButton.classList.add('add-button')
                    wayContainer.appendChild(addButton)

                    // 在按钮上添加点击事件监听器，点击时调用 addPath 函数
                    addButton.addEventListener('click', () => {
                        addPath(i) // 将新增路径插入到当前路线后面
                        console.log(`addPath ${i}`)
                    })
                }
            })

            // 在最前面添加一个新增按钮
            const addButton = document.createElement('button')
            addButton.textContent = '新增'
            addButton.classList.add('add-button')
            wayContainer.insertBefore(addButton, wayContainer.firstChild)
            // 在按钮上添加点击事件监听器，点击时弹出新增窗口
            addButton.addEventListener('click', () => {
                openModal() // 调用 openModal() 函数以显示新增窗口
                // 保存索引0作为参数传递给 addPath 函数
                addPath(-1)
            })
            // 在更新状态时调用的函数，更新到达后是否吃饭的选项
            window.updateEat = function (index, checked) {
                ways[index].eat = checked
                console.log(`Way ${index} eat status updated: ${checked}`)
                refresh() // 更新界面
            }
            // 在更新状态时调用的函数，更新最迟到达时间的选项
            window.updateMustBeEntime = function (index, value) {
                ways[index].mustbeentime = value
                console.log(`Way ${index} must be entime updated: ${value}`)
                refresh() // 更新界面
            }
            // 编辑路径
            window.editWay = function (index) {
                // 获取要编辑的路径对象
                const way = ways[index]

                // 将路径对象的数据填充到编辑窗口的表单中
                document.getElementById('editType').value = way.type
                document.getElementById('editFrom').value = way.from
                document.getElementById('editTo').value = way.to
                document.getElementById('editM').value = way.m || ''
                // 根据类型显示对应的字段
                updateEditUI() // 更新编辑窗口显示的字段

                // 如果是公交车或火车类型，填入发车时间或途径时间
                if (way.type === 'bus') {
                    fillEditStartTime(way.start)
                } else if (way.type === 'railway') {
                    fillEditWayTime(way.way)
                } else if (way.type === 'main') {
                    document.getElementById('editName').value = way.name || ''
                    document.getElementById('editStartTime').value = way.start || ''
                    document.getElementById('editEndTime').value = way.end || ''
                }

                editPath(index) // 将编辑操作应用到当前路径
                console.log(`editPath ${index}`)
                // 显示编辑窗口
                document.getElementById('editModal').classList.remove('hidden')
            }
            // 辅助函数：将时间格式化为 "hh:mm" 格式
            function formatTime(hours, minutes) {
                // 如果小时或分钟小于10，则在其前面添加0以确保两位数字格式
                const formattedHours = String(hours).padStart(2, '0')
                const formattedMinutes = String(minutes).padStart(2, '0')
                return `${formattedHours}:${formattedMinutes}`
            }

            // 填充编辑窗口中的发车时间
            function fillEditStartTime(startTimes) {
                const startInputsContainer = document.getElementById('editStartInputs')
                startInputsContainer.innerHTML = '' // 清空现有的输入框

                startTimes.forEach((time, index) => {
                    const input = document.createElement('input')
                    input.type = 'time'
                    input.classList.add('edit-start-time')

                    // 解析时间字符串并格式化为 "hh:mm" 格式
                    const [hours, minutes] = time.split(':')
                    const formattedTime = formatTime(hours, minutes)
                    input.value = formattedTime // 设置时间输入框的值

                    startInputsContainer.appendChild(input)

                    // 添加删除按钮
                    addDeleteStartTimeButton(startInputsContainer, index)
                })
            }

            // 填充编辑窗口中的途径时间
            function fillEditWayTime(wayTimes) {
                const wayInputsContainer = document.getElementById('editWayInputs')
                wayInputsContainer.innerHTML = '' // 清空现有的输入框

                wayTimes.forEach((time, index) => {
                    const startInput = document.createElement('input')
                    startInput.type = 'time'
                    startInput.classList.add('edit-way-time')

                    // 解析时间字符串并格式化为 "hh:mm" 格式
                    const [startHours, startMinutes] = time.start.split(':')
                    const formattedStartTime = formatTime(startHours, startMinutes)
                    startInput.value = formattedStartTime // 设置起始时间输入框的值

                    const span = document.createElement('span')
                    span.textContent = ' - '

                    const endInput = document.createElement('input')
                    endInput.type = 'time'
                    endInput.classList.add('edit-way-time')

                    // 解析时间字符串并格式化为 "hh:mm" 格式
                    const [endHours, endMinutes] = time.end.split(':')
                    const formattedEndTime = formatTime(endHours, endMinutes)
                    endInput.value = formattedEndTime // 设置结束时间输入框的值

                    wayInputsContainer.appendChild(startInput)
                    wayInputsContainer.appendChild(span)
                    wayInputsContainer.appendChild(endInput)

                    // 添加删除按钮
                    addDeleteWayTimeButton(wayInputsContainer, index)
                })
            }

            // 保存路线修改
            function saveWayChanges(index) {
                const editedWay = ways[index]
                // 根据编辑表单中的值更新路线信息
                if (editedWay.type !== 'main') {
                    editedWay.from = document.getElementById('editFrom').value
                    editedWay.to = document.getElementById('editTo').value
                } else {
                    editedWay.name = document.getElementById('editName').value
                    editedWay.start = document.getElementById('editStartTime').value
                    editedWay.end = document.getElementById('editEndTime').value
                }
                // 重新渲染路线图
                renderWayContainer()
            }
        }
        // 更新编辑窗口显示的字段
        function updateEditUI() {
            const selectedType = document.getElementById('editType').value

            // 调用 setFormFieldVisibility() 设置表单字段的可见性
            setFormFieldVisibility(selectedType, 'edit')
        }
        // 关闭编辑窗口
        function closeEditModal() {
            const editModal = document.getElementById('editModal')
            editModal.classList.add('hidden')
        }
        renderWayContainer()
        // 获取侧边栏、菜单按钮、表格视图和修改界面的引用
        const sidebar = document.getElementById('sidebar')
        const menuButton = document.getElementById('menuButton')
        const tableContent = document.getElementById('tableContent')
        const formContent = document.getElementById('formContent')
        const configContent = document.getElementById('configContent')
        const dataManagement = document.getElementById('dataManagement')
        const updateLogContent = document.getElementById('updateLog')
        const supportAuthor = document.getElementById('supportAuthor')
        const developerContent = document.getElementById('developerContent')

        // 获取侧边导航栏的链接
        const tableLink = document.getElementById('tableLink')
        const formLink = document.getElementById('formLink')
        // 获取修改配置导航栏链接
        const configLink = document.getElementById('configLink')
        const dataLink = document.getElementById('dataLink')
        const logLink = document.getElementById('logLink')
        const supportLink = document.getElementById('supportLink')
        const devLink = document.getElementById('devLink')

        // 添加事件监听器以切换界面
        devLink.addEventListener('click', () => {
            developerContent.classList.remove('hidden')
            tableContent.classList.add('hidden')
            formContent.classList.add('hidden')
            configContent.classList.add('hidden')
            dataManagement.classList.add('hidden')
            updateLogContent.classList.add('hidden')
            supportAuthor.classList.add('hidden')
        })
        // 添加事件监听器以切换界面
        tableLink.addEventListener('click', () => {
            tableContent.classList.remove('hidden')
            formContent.classList.add('hidden')
            configContent.classList.add('hidden')
            dataManagement.classList.add('hidden')
            updateLogContent.classList.add('hidden')
            supportAuthor.classList.add('hidden')
            developerContent.classList.add('hidden')
        })

        formLink.addEventListener('click', () => {
            tableContent.classList.add('hidden')
            developerContent.classList.add('hidden')
            formContent.classList.remove('hidden')
            // 显示路线图
            wayContainer.classList.remove('hidden')
            configContent.classList.add('hidden')
            dataManagement.classList.add('hidden')
            updateLogContent.classList.add('hidden')
            supportAuthor.classList.add('hidden')
        })
        // 添加事件监听器以切换界面
        configLink.addEventListener('click', () => {
            tableContent.classList.add('hidden')
            developerContent.classList.add('hidden')
            formContent.classList.add('hidden')
            configContent.classList.remove('hidden')
            dataManagement.classList.add('hidden')
            updateLogContent.classList.add('hidden')
            supportAuthor.classList.add('hidden')
        })
        // 添加事件监听器以切换界面
        dataLink.addEventListener('click', () => {
            tableContent.classList.add('hidden')
            formContent.classList.add('hidden')
            developerContent.classList.add('hidden')
            configContent.classList.add('hidden')
            dataManagement.classList.remove('hidden')
            updateLogContent.classList.add('hidden')
            supportAuthor.classList.add('hidden')
        })
        // 添加事件监听器以切换界面
        logLink.addEventListener('click', () => {
            tableContent.classList.add('hidden')
            formContent.classList.add('hidden')
            configContent.classList.add('hidden')
            developerContent.classList.add('hidden')
            dataManagement.classList.add('hidden')
            updateLogContent.classList.remove('hidden')
            supportAuthor.classList.add('hidden')
        })
        // 添加事件监听器以切换界面
        supportLink.addEventListener('click', () => {
            tableContent.classList.add('hidden')
            formContent.classList.add('hidden')
            configContent.classList.add('hidden')
            dataManagement.classList.add('hidden')
            updateLogContent.classList.add('hidden')
            developerContent.classList.add('hidden')
            supportAuthor.classList.remove('hidden')
        })
        // 添加事件监听器以显示/隐藏侧边栏
        menuButton.addEventListener('click', () => {
            const modal = document.getElementById('addModal')
            const editModal = document.getElementById('editModal')
            // 如果侧边栏是隐藏的，则显示；否则隐藏
            if (sidebar.style.left === '-200px') {
                sidebar.style.left = '0'
                // 缩小主界面内容
                if (!isMobile()) {
                    tableContent.style.marginLeft = '200px'
                    formContent.style.marginLeft = '200px'
                    configContent.style.marginLeft = '200px'
                    dataManagement.style.marginLeft = '200px'
                    updateLogContent.style.marginLeft = '200px'
                    supportAuthor.style.marginLeft = '200px'
                    developerContent.style.marginLeft = '200px'
                    modal.style.marginLeft = '200px'
                    modal.style.width = 'calc(100vw - 200px)'
                    editModal.style.marginLeft = '200px'
                    editModal.style.width = 'calc(100vw - 200px)'
                }
            } else {
                sidebar.style.left = '-200px'
                // 恢复主界面内容大小
                tableContent.style.marginLeft = '0'
                formContent.style.marginLeft = '0'
                configContent.style.marginLeft = '0'
                dataManagement.style.marginLeft = '0'
                updateLogContent.style.marginLeft = '0'
                supportAuthor.style.marginLeft = '0'
                developerContent.style.marginLeft = '0'
                modal.style.marginLeft = '0'
                modal.style.width = '100vw'
                editModal.style.marginLeft = '0'
                editModal.style.width = '100vw'
            }
        })

        // 函数用于检测是否为手机端
        function isMobile() {
            return window.innerWidth <= 768 // 768px是典型的平板电脑宽度
        }

        // 设置选中状态
        function setActive(element) {
            // 先移除所有已经被选中的元素的active类
            const links = document.querySelectorAll('nav ul li')
            links.forEach((link) => link.classList.remove('active'))
            // 为当前选中的元素添加active类
            element.parentElement.classList.add('active')
        }

        // 添加事件监听器以显示/隐藏侧边栏
        function toggleActive() {
            const menuButton = document.getElementById('menuButton')
            menuButton.classList.toggle('active')
        }

        function addAddButton(container) {
            const addButton = document.createElement('button')
            addButton.textContent = '新增'
            addButton.classList.add('add-button')
            container.appendChild(addButton)

            // 在按钮上添加点击事件监听器，点击时弹出新增窗口
            addButton.addEventListener('click', () => {
                // 创建遮罩层
                const overlay = document.createElement('div')
                overlay.classList.add('overlay')
                document.body.appendChild(overlay)

                // 创建新增窗口
                //       const addWindow = document.createElement('div')
                //       addWindow.classList.add('add-window')
                //       addWindow.innerHTML = `
                //   <h2>新增路线</h2>
                //   <label for="routeType">类型：</label>
                //   <select id="routeType">
                //     <option value="foot">步行</option>
                //     <option value="bus">公交车</option>
                //     <option value="railway">火车</option>
                //     <!-- 在这里添加其他类型 -->
                //   </select>
                //   <!-- 在这里添加其他输入字段 -->
                //   <button id="confirmButton">确认</button>
                //   <button id="cancelButton">取消</button>
                // `
                // 在这里调用 openModal() 函数来显示新增窗口
                openModal()

                document.body.appendChild(addWindow)

                // 添加确认按钮点击事件监听器
                const confirmButton = document.getElementById('confirmButton')
                confirmButton.addEventListener('click', () => {
                    // 获取新增窗口中的数据
                    const routeType = document.getElementById('routeType').value
                    // 获取其他输入字段的数据
                    // 在这里添加获取其他输入字段数据的逻辑

                    // 在这里可以将获取到的数据发送到后端保存或执行其他操作

                    // 关闭新增窗口和遮罩层
                    document.body.removeChild(addWindow)
                    document.body.removeChild(overlay)
                })

                // 添加取消按钮点击事件监听器
                const cancelButton = document.getElementById('cancelButton')
                cancelButton.addEventListener('click', () => {
                    // 关闭新增窗口和遮罩层
                    document.body.removeChild(addWindow)
                    document.body.removeChild(overlay)
                })
            })
        }

        // 定义一个全局变量用于存储表单提交事件监听器
        let submitEventListener = null
        let submitEventListener1 = null
        // 添加公交车的发车时间字段
        function addTimeField(containerId) {
            const container = document.getElementById(containerId)
            const timeField = document.createElement('input')
            timeField.type = 'time'
            container.insertBefore(timeField, container.lastChild)
        }
        // 添加火车的途径时间字段
        function addWayField(containerId) {
            const container = document.getElementById(containerId)
            const wayField = document.createElement('div')
            const startTimeField = document.createElement('input')
            startTimeField.type = 'time'
            const separator = document.createElement('span')
            separator.textContent = ' - '
            const endTimeField = document.createElement('input')
            endTimeField.type = 'time'
            wayField.appendChild(startTimeField)
            wayField.appendChild(separator)
            wayField.appendChild(endTimeField)
            container.insertBefore(wayField, container.lastChild)
        }
        function addPath(index) {
            // 显示新增窗口
            openModal()

            // 获取表单元素
            const addForm = document.getElementById('addForm')

            // 移除之前的事件监听器
            if (submitEventListener) {
                addForm.removeEventListener('submit', submitEventListener)
            }

            // 修改提交事件处理函数以适应新的字段结构
            submitEventListener = function (event) {
                event.preventDefault()

                // 获取表单数据
                const type = document.getElementById('type').value
                const from = type !== 'main' ? document.getElementById('from').value : ''
                const to = type !== 'main' ? document.getElementById('to').value : ''
                const m = type !== 'railway' && type !== 'main' ? document.getElementById('m').value : ''
                let start = []
                let way = []
                let name = ''
                let startTime = ''
                let endTime = ''

                if (type === 'bus') {
                    const startInputs = document.querySelectorAll('#startFields .start-time')
                    startInputs.forEach((input) => {
                        start.push(input.value)
                    })
                } else if (type === 'railway') {
                    const wayInputs = document.querySelectorAll('#wayFields .way-time')
                    for (let i = 0; i < wayInputs.length; i += 2) {
                        const startTime = wayInputs[i].value
                        const endTime = wayInputs[i + 1].value
                        way.push({ start: startTime, end: endTime })
                    }
                } else if (type === 'main') {
                    name = document.getElementById('name').value
                    startTime = document.getElementById('startTime').value
                    endTime = document.getElementById('endTime').value
                }

                // 创建路径对象
                // const newWay = { type, from, to, m, start, way, name, startTime, endTime }
                let newWay
                // 添加空值检测，如果有任何一个字段为空值，则弹出警告并停止创建新路径对象
                if (type === 'foot') {
                    if (!from || !to || !m) {
                        alert('请填写所有必填字段！')
                        return
                    }
                    newWay = { type, from, to, m }
                } else if (type === 'bus') {
                    if (!from || !to || !m || start.some((time) => !time)) {
                        alert('请填写所有必填字段！')
                        return
                    }
                    newWay = { type, from, to, m, start }
                } else if (type === 'railway') {
                    if (!from || !to || way.some((time) => !time.start || !time.end)) {
                        alert('请填写所有必填字段！')
                        return
                    }
                    newWay = { type, from, to, way }
                } else if (type === 'main') {
                    if (!name || !startTime || !endTime) {
                        alert('请填写所有必填字段！')
                        return
                    }
                    newWay = { type, name, start: startTime, end: endTime }
                }

                // 将新增路径添加到指定的索引位置
                ways.splice(index + 1, 0, newWay)
                console.log(index + 1)

                // 重新渲染路线图
                refresh()

                // 清空表单
                document.getElementById('addForm').reset()

                // 关闭新增窗口
                closeModal()
            }

            // 添加表单提交事件监听器
            addForm.addEventListener('submit', submitEventListener)

            // 根据选择的类型动态显示/隐藏额外输入字段
            const typeSelect = document.getElementById('type')
            const additionalFields = document.getElementById('additionalFields')
            // 在 typeSelect 元素上添加 change 事件监听器
            typeSelect.addEventListener('change', updateUI)
            // 页面加载时更新界面
            updateUI()
        }
        // 更新界面显示和隐藏的逻辑
        function updateUI() {
            const typeSelect = document.getElementById('type')
            const selectedType = typeSelect.options[typeSelect.selectedIndex].value

            setFormFieldVisibility(selectedType)
        }
        // 添加额外字段的函数
        function addAdditionalField(id, label, type, required, isMultiple, visible) {
            required = false
            if (!visible) {
                return // 如果字段不可见，则不添加
            }
            const fieldDiv = document.createElement('div')
            fieldDiv.classList.add('additional-field')

            let fieldHTML = `<label for="${id}">${label}：</label>`
            if (type === 'text' || type === 'number') {
                fieldHTML += `<input type="${type}" id="${id}" ${required ? 'required' : ''} />`
            } else if (type === 'select') {
                fieldHTML += `<select id="${id}" ${required ? 'required' : ''}></select>`
            }

            if (isMultiple) {
                const addButton = document.createElement('button')
                addButton.textContent = '添加'
                addButton.addEventListener('click', function () {
                    const input = document.createElement('input')
                    input.type = type
                    input.classList.add('dynamic-input')
                    input.placeholder = '请输入...'
                    fieldDiv.appendChild(input)
                })
                fieldHTML += ' '
                fieldHTML += addButton.outerHTML
            }

            fieldDiv.innerHTML = fieldHTML
            additionalFields.appendChild(fieldDiv)
        }
        // 添加更多发车时间输入框
        function addStartTime() {
            const startInputs = document.getElementById('startInputs')
            const newInput = document.createElement('input')
            newInput.type = 'time'
            newInput.className = 'start-time'
            // newInput.required = true
            startInputs.appendChild(newInput)
        }
        // 添加更多途径时间输入框
        function addWayTime() {
            const wayInputs = document.getElementById('wayInputs')
            const newWayInputStart = document.createElement('input')
            const newWayInputEnd = document.createElement('input')
            newWayInputStart.type = 'time'
            newWayInputStart.className = 'way-time'
            // newWayInputStart.required = true
            newWayInputEnd.type = 'time'
            newWayInputEnd.className = 'way-time'
            // newWayInputEnd.required = true
            const span = document.createElement('span')
            span.textContent = ' - '
            wayInputs.appendChild(newWayInputStart)
            wayInputs.appendChild(span)
            wayInputs.appendChild(newWayInputEnd)
        }
        // 设置表单字段的可见性
        function setFormFieldVisibility(type, formId) {
            const startFields = document.getElementById(formId !== undefined ? formId + 'StartFields' : 'startFields')
            const wayFields = document.getElementById(formId !== undefined ? formId + 'WayFields' : 'wayFields')
            const additionalFields = document.getElementById(
                formId !== undefined ? formId + 'AdditionalFields' : 'additionalFields',
            )
            const mField = document.getElementById(formId !== undefined ? formId + 'M' : 'm') // 耗时字段
            const fromLabel = document.querySelector(
                'label[for="' + (formId !== undefined ? formId + 'From' : 'from') + '"]',
            ) // 出发地字段对应的标签
            const toLabel = document.querySelector('label[for="' + (formId !== undefined ? formId + 'To' : 'to') + '"]') // 目的地字段对应的标签
            const mLabel = document.querySelector('label[for="' + (formId !== undefined ? formId + 'M' : 'm') + '"]') // 耗时字段对应的标签

            // 隐藏所有字段
            startFields.classList.add('hidden-field')
            wayFields.classList.add('hidden-field')
            additionalFields.classList.add('hidden-field')

            // 根据选择的类型显示相应的字段
            if (type === 'bus') {
                document.getElementById(formId !== undefined ? formId + 'From' : 'from').classList.remove('hidden-field')
                document.getElementById(formId !== undefined ? formId + 'To' : 'to').classList.remove('hidden-field')
                startFields.classList.remove('hidden-field') // 显示公交车的发车时间字段
                mField.classList.remove('hidden-field') // 显示耗时字段
                mLabel.classList.remove('hidden-field')
                fromLabel.classList.remove('hidden-field')
                toLabel.classList.remove('hidden-field')
            } else if (type === 'railway') {
                document.getElementById(formId !== undefined ? formId + 'From' : 'from').classList.remove('hidden-field')
                document.getElementById(formId !== undefined ? formId + 'To' : 'to').classList.remove('hidden-field')
                wayFields.classList.remove('hidden-field') // 显示火车的途径时间字段
                mField.classList.add('hidden-field') // 隐藏耗时字段
                mLabel.classList.add('hidden-field')
                fromLabel.classList.remove('hidden-field')
                toLabel.classList.remove('hidden-field')
            } else if (type === 'main') {
                additionalFields.classList.remove('hidden-field') // 显示主要活动的额外字段
                // 隐藏出发地、目的地和耗时字段
                document.getElementById(formId !== undefined ? formId + 'From' : 'from').classList.add('hidden-field')
                document.getElementById(formId !== undefined ? formId + 'To' : 'to').classList.add('hidden-field')
                mField.classList.add('hidden-field')
                fromLabel.classList.add('hidden-field')
                toLabel.classList.add('hidden-field')
                mLabel.classList.add('hidden-field')
            } else {
                document.getElementById(formId !== undefined ? formId + 'From' : 'from').classList.remove('hidden-field')
                document.getElementById(formId !== undefined ? formId + 'To' : 'to').classList.remove('hidden-field')
                mField.classList.remove('hidden-field') // 显示耗时字段（步行类型）
                fromLabel.classList.remove('hidden-field')
                toLabel.classList.remove('hidden-field')
                mLabel.classList.remove('hidden-field')
            }
        }

        // 获取额外字段的值
        function getAdditionalFieldValues(selectedType) {
            const additionalValues = {}
            const additionalFieldDivs = document.querySelectorAll('.additional-field')
            additionalFieldDivs.forEach((fieldDiv) => {
                const fieldId = fieldDiv.querySelector('label').getAttribute('for')
                const fieldInputs = fieldDiv.querySelectorAll('input.dynamic-input')
                if (fieldInputs.length === 1) {
                    // 单个输入框的情况
                    const fieldValue = fieldDiv.querySelector(`#${fieldId}`).value
                    additionalValues[fieldId] = fieldValue
                } else {
                    // 多个输入框的情况
                    const fieldValues = []
                    fieldInputs.forEach((input) => {
                        if (input.value.trim() !== '') {
                            fieldValues.push(input.value.trim())
                        }
                    })
                    additionalValues[fieldId] = fieldValues
                }
            })
            return additionalValues
        }
        // 添加发车时间
        function addEditStartTime() {
            const startInputs = document.getElementById('editStartInputs')
            const input = document.createElement('input')
            input.type = 'time'
            input.className = 'edit-start-time'
            startInputs.appendChild(input)

            // 添加删除按钮
            addDeleteStartTimeButton(input.parentElement, (startInputs.children.length - 1) / 2)
        }

        // 添加途径时间
        function addEditWayTime() {
            const wayInputs = document.getElementById('editWayInputs')
            const wayInputContainer = document.createElement('div')
            wayInputContainer.className = 'way-input-container'

            const startInput = document.createElement('input')
            startInput.type = 'time'
            startInput.className = 'edit-way-time'
            wayInputContainer.appendChild(startInput)

            const separator = document.createElement('span')
            separator.textContent = ' - '
            wayInputContainer.appendChild(separator)

            const endInput = document.createElement('input')
            endInput.type = 'time'
            endInput.className = 'edit-way-time'
            wayInputContainer.appendChild(endInput)

            // 添加删除按钮
            const deleteButton = document.createElement('button')
            deleteButton.textContent = '删除'
            deleteButton.type = 'button'
            deleteButton.className = 'delete-button'
            deleteButton.onclick = function () {
                deleteWayTime(Math.floor(wayInputs.children.length / 4))
                generateDeleteButtons() // 在删除后重新生成所有删除按钮
            }
            wayInputContainer.appendChild(deleteButton)

            wayInputs.appendChild(wayInputContainer)
        }
        // 删除指定索引的发车时间
        function deleteStartTime(index) {
            const startInputs = document.querySelectorAll('.edit-start-time')
            if (startInputs.length > 1) {
                const startInput = startInputs[index]
                const deleteButton = startInput.nextElementSibling // 获取下一个兄弟节点（即删除按钮）
                startInput.parentNode.removeChild(startInput) // 删除时间输入框
                deleteButton.parentNode.removeChild(deleteButton) // 删除对应的删除按钮
            }
        }
        function editPath(index) {
            // 显示编辑窗口
            // openEditModal()

            // 获取表单元素
            const editForm = document.getElementById('editForm')

            // 移除之前的事件监听器
            if (submitEventListener1) {
                editForm.removeEventListener('submit', submitEventListener1)
            }

            // 修改提交事件处理函数以适应新的字段结构
            submitEventListener1 = function (event) {
                event.preventDefault()

                // 获取表单数据
                const type = document.getElementById('editType').value
                const from = type !== 'main' ? document.getElementById('editFrom').value : ''
                const to = type !== 'main' ? document.getElementById('editTo').value : ''
                const m = type !== 'railway' && type !== 'main' ? document.getElementById('editM').value : ''
                let start = []
                let way = []
                let name = ''
                let startTime = ''
                let endTime = ''

                // 获取其他字段的值，根据需要添加更多的字段处理

                // 将索引作为参数传递给保存函数
                savePath(index)
            }

            // 添加表单提交事件监听器
            editForm.addEventListener('submit', submitEventListener1)

            // 根据选择的类型动态显示/隐藏额外输入字段
            const editTypeSelect = document.getElementById('editType')
            const editAdditionalFields = document.getElementById('editAdditionalFields')
            // 在 typeSelect 元素上添加 change 事件监听器
            editTypeSelect.addEventListener('change', updateEditUI)
            // 页面加载时更新界面
            updateEditUI()
        }
        function savePath(index) {
            // 阻止表单默认提交行为
            event.preventDefault()

            // 获取编辑表单中的数据
            const type = document.getElementById('editType').value
            const from = document.getElementById('editFrom').value
            const to = document.getElementById('editTo').value
            const m = document.getElementById('editM').value
            let start = []
            let way = []
            let name = ''
            let startTime = ''
            let endTime = ''

            // 根据不同类型获取不同字段的值
            if (type === 'bus') {
                const startInputs = document.querySelectorAll('#editStartFields .edit-start-time')
                startInputs.forEach((input) => {
                    start.push(input.value)
                })
            } else if (type === 'railway') {
                const wayInputs = document.querySelectorAll('#editWayFields .edit-way-time')
                for (let i = 0; i < wayInputs.length; i += 2) {
                    const startTime = wayInputs[i].value
                    const endTime = wayInputs[i + 1].value
                    way.push({ start: startTime, end: endTime })
                }
            } else if (type === 'main') {
                name = document.getElementById('editName').value
                startTime = document.getElementById('editStartTime').value
                endTime = document.getElementById('editEndTime').value
            }

            // 创建路径对象
            let newWay
            if (type === 'foot') {
                if (!from || !to || !m) {
                    alert('请填写所有必填字段！')
                    return
                }
                newWay = { type, from, to, m }
            } else if (type === 'bus') {
                if (!from || !to || !m || start.some((time) => !time)) {
                    alert('请填写所有必填字段！')
                    return
                }
                newWay = { type, from, to, m, start }
            } else if (type === 'railway') {
                if (!from || !to || way.some((time) => !time.start || !time.end)) {
                    alert('请填写所有必填字段！')
                    return
                }
                newWay = { type, from, to, way }
            } else if (type === 'main') {
                if (!name || !startTime || !endTime) {
                    alert('请填写所有必填字段！')
                    return
                }
                newWay = { type, name, start: startTime, end: endTime }
            }
            if (ways[index].eat !== undefined) newWay.eat = ways[index].eat
            if (ways[index].mustbeentime !== undefined) newWay.mustbeentime = ways[index].mustbeentime
            // 将编辑后的路径对象插入到指定的索引位置
            ways.splice(index, 1, newWay)

            // 重新渲染路线图
            refresh()

            // 关闭编辑窗口
            closeEditModal()
        }

        // 删除指定索引的途径时间
        function deleteWayTime(index) {
            const wayInputs = document.querySelectorAll('.edit-way-time')
            if (wayInputs.length > 1) {
                const startIndex = index * 2 // 每个途径时间有两个输入框
                const startInput = wayInputs[startIndex]
                const deleteButton = startInput.nextElementSibling // 获取下一个兄弟节点（即删除按钮）
                startInput.parentNode.removeChild(startInput) // 删除起始时间输入框
                deleteButton.parentNode.removeChild(deleteButton) // 删除对应的删除按钮

                const endIndex = startIndex + 1
                const endInput = wayInputs[endIndex]
                const waySpan = endInput.nextElementSibling // 获取下一个兄弟节点（即间隔符号）
                endInput.parentNode.removeChild(endInput) // 删除结束时间输入框
                waySpan.parentNode.removeChild(waySpan) // 删除间隔符号
            }
        }
        // 添加删除按钮
        function addDeleteButton(parentNode, onClickHandler) {
            const deleteButton = document.createElement('button')
            deleteButton.textContent = '删除'
            deleteButton.type = 'button'
            deleteButton.addEventListener('click', onClickHandler)
            parentNode.appendChild(deleteButton)
        }

        // 添加删除发车时间按钮
        function addDeleteStartTimeButton(parentElement, index) {
            const deleteButton = document.createElement('button')
            deleteButton.textContent = '删除'
            deleteButton.type = 'button'
            deleteButton.classList.add('delete-button')
            deleteButton.onclick = function () {
                deleteStartTime(index)
                generateDeleteButtons() // 在删除后重新生成所有删除按钮
            }
            parentElement.appendChild(deleteButton)
        }

        // 添加删除途径时间按钮
        function addDeleteWayTimeButton(parentElement, index) {
            const deleteButton = document.createElement('button')
            deleteButton.textContent = '删除'
            deleteButton.type = 'button'
            deleteButton.classList.add('delete-button')
            deleteButton.onclick = function () {
                deleteWayTime(index)
                generateDeleteButtons() // 在删除后重新生成所有删除按钮
            }
            parentElement.appendChild(deleteButton)
        }
        function deleteWay(index) {
            // 确认是否删除该路线
            const confirmDelete = confirm('确定要删除该路线吗？')
            if (confirmDelete) {
                // 从 ways 数组中删除指定索引的路线
                ways.splice(index, 1)
                // 重新渲染路线图
                refresh()
            }
        }
        // 生成所有删除按钮
        function generateDeleteButtons() {
            const startInputs = document.querySelectorAll('.edit-start-time')
            const wayInputs = document.querySelectorAll('.edit-way-time')

            // 清除所有已有的删除按钮
            document.querySelectorAll('.delete-button').forEach((button) => button.remove())

            // 生成删除按钮并插入
            for (let i = 0; i < Math.max(startInputs.length, wayInputs.length); i++) {
                if (startInputs[i]) {
                    const deleteButton = createDeleteButton('deleteStartTime', i)
                    startInputs[i].parentNode.insertBefore(deleteButton, startInputs[i].nextElementSibling)
                }
                if (wayInputs[i] && i % 2 === 1) {
                    const deleteButton = createDeleteButton('deleteWayTime', Math.floor(i / 2))
                    wayInputs[i].parentNode.insertBefore(deleteButton, wayInputs[i].nextElementSibling)
                }
            }
        }

        // 创建删除按钮
        function createDeleteButton(handlerName, index) {
            const deleteButton = document.createElement('button')
            deleteButton.textContent = '删除'
            deleteButton.type = 'button'
            deleteButton.classList.add('delete-button')
            deleteButton.onclick = function () {
                window[handlerName](index)
                generateDeleteButtons() // 在删除后重新生成所有删除按钮
            }
            return deleteButton
        }
        // 定义生成修改配置界面的函数
        function generateConfigUI() {
            // 获取配置内容的容器
            var configContent = document.getElementById('configContent')
            configContent.innerHTML = '' // 清空容器

            // 遍历config对象的属性
            for (var key in config) {
                // 创建label元素
                var label = document.createElement('label')
                label.textContent = config[key].meaning + '：'
                label.className = 'config-label' // 添加class

                // 创建input元素
                var input = document.createElement('input')
                input.type = typeof config[key].val === 'number' ? 'number' : 'text'
                input.id = key
                input.value = config[key].val
                input.className = 'config-input' // 添加class

                // 创建div元素作为每个配置项的容器
                var configItem = document.createElement('div')
                configItem.className = 'config-field' // 添加class

                // 将label和input元素添加到容器中
                configItem.appendChild(label)
                configItem.appendChild(input)

                // 将每个配置项的容器添加到配置内容容器中
                configContent.appendChild(configItem)
            }

            // 创建提交按钮
            var submitButton = document.createElement('input')
            submitButton.type = 'submit'
            submitButton.value = '保存'
            submitButton.className = 'save-button' // 添加class
            submitButton.addEventListener('click', () => {
                // 收集表单数据
                const name = document.getElementById('fName').value
                const wakeUpPreparationTime = document.getElementById('wakeUpPreparationTime').value
                const preventMissingHighSpeedRailTime = document.getElementById('preventMissingHighSpeedRailTime').value
                const mealTime = document.getElementById('mealTime').value

                // 更新config对象
                config.wakeUpPreparationTime.val = wakeUpPreparationTime
                config.preventMissingHighSpeedRailTime.val = preventMissingHighSpeedRailTime
                config.mealTime.val = mealTime
                config.fName.val = name

                refresh()

                // 提示保存成功或其他操作
                alert('保存成功！')
            })

            // 将提交按钮添加到容器中
            configContent.appendChild(submitButton)
        }

        // 在页面加载时生成修改配置界面
        generateConfigUI()
        // 将ways和config保存到localStorage中
        function saveDataToLocalStorage() {
            // 检查浏览器是否支持localStorage
            if (typeof localStorage !== 'undefined') {
                // 将ways和config对象转换为JSON字符串并保存到localStorage中
                localStorage.setItem('ways', JSON.stringify(ways))
                localStorage.setItem('config', JSON.stringify(config))
                console.log('Data saved to localStorage.')
            } else {
                console.log('localStorage is not supported in this browser.')
            }
        }

        // 从localStorage中读取数据
        function loadDataFromLocalStorage() {
            // 检查浏览器是否支持localStorage
            if (typeof localStorage !== 'undefined') {
                // 尝试从localStorage中获取保存的数据
                const savedWays = localStorage.getItem('ways')
                const savedConfig = localStorage.getItem('config')

                // 如果localStorage中有保存的数据，则解析JSON字符串并更新ways和config对象
                if (savedWays && savedConfig) {
                    ways = JSON.parse(savedWays)
                    config = JSON.parse(savedConfig)
                    console.log('Data loaded from localStorage.')
                    refresh()
                } else {
                    console.log('No data found in localStorage.')
                }
            } else {
                console.log('localStorage is not supported in this browser.')
            }
        }

        // 在页面加载时执行函数以加载数据
        window.addEventListener('load', function () {
            const confirmLoad = confirm('是否要从本地存储中加载数据？')
            if (confirmLoad) {
                loadDataFromLocalStorage()
            }
        })
        // 导出数据为JSON文件
        function exportData() {
            const data = {
                ways: ways,
                config: config,
            }
            const json = JSON.stringify(data)
            const blob = new Blob([json], { type: 'application/json' })
            const url = URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = config.fName.val + '.json'
            document.body.appendChild(a)
            a.click()
            document.body.removeChild(a)
            URL.revokeObjectURL(url)
        }

        // 导入JSON文件并更新数据
        function importData(event) {
            const file = event.target.files[0]
            if (!file) return
            const reader = new FileReader()
            reader.onload = function (event) {
                const json = event.target.result
                try {
                    const data = JSON.parse(json)
                    ways = data.ways
                    config = data.config
                    console.log('Data imported successfully.')
                    refresh()
                    alert('数据导入成功！')
                } catch (error) {
                    console.error('Error importing data:', error)
                    alert('数据导入失败，请检查文件格式！')
                }
            }
            reader.readAsText(file)
        }
        function displayUpdateLog() {
            const updateLogContent = document.getElementById('updateLogContent')
            updateLogContent.innerHTML = '' // 清空内容

            updateLog.forEach((update) => {
                const updateItem = document.createElement('div')
                updateItem.classList.add('update-item')
                // updateItem.innerHTML = `<span class="update-date">${update.date}</span>: ${update.content}`
                updateItem.innerHTML = `${update.content}`
                updateLogContent.appendChild(updateItem)
            })
        }
        displayUpdateLog()
        // 生成支持作者界面的函数
        function generateSupportAuthorUI() {
            // 获取支持作者表格的 tbody 元素
            const supportAuthorTableBody = document.getElementById('supportAuthorTableBody')

            // 清空表格内容
            supportAuthorTableBody.innerHTML = ''

            // 遍历数据数组，生成表格行
            supportData.forEach((data) => {
                // 创建表格行
                const row = document.createElement('tr')
                row.classList.add('row')

                // 创建并设置单元格内容
                const nameCell = document.createElement('td')
                nameCell.classList.add('column')
                nameCell.textContent = data.name

                const amountCell = document.createElement('td')
                amountCell.classList.add('column')
                amountCell.textContent = data.amount

                const messageCell = document.createElement('td')
                messageCell.classList.add('column')
                messageCell.textContent = data.message

                const feedbackCell = document.createElement('td')
                feedbackCell.classList.add('column')
                feedbackCell.textContent = data.feedback

                // 将单元格添加到行中
                row.appendChild(nameCell)
                row.appendChild(amountCell)
                row.appendChild(messageCell)
                row.appendChild(feedbackCell)

                // 将行添加到表格中
                supportAuthorTableBody.appendChild(row)
            })
        }

        // 调用函数生成界面
        generateSupportAuthorUI()
        function generatePieChart(paths) {
            // 计算总时间
            function calculateTotalTime(paths) {
                let totalTime = 0
                paths.forEach((path) => {
                    totalTime += parseTime(path.past)
                })
                return totalTime
            }

            // 解析时间字符串为分钟
            function parseTime(timeString) {
                // 分割字符串并去除多余空格
                const parts = timeString.trim().split('时')

                // 初始化分钟数
                let minutes = 0

                if (parts.length === 1) {
                    // 如果只包含“分”部分或无分部分，处理
                    if (parts[0].includes('分')) {
                        minutes = parseInt(parts[0].replace('分', ''), 10)
                    } else {
                        minutes = parseInt(parts[0], 10) * 60
                    }
                } else {
                    // 含有“时”和“分”部分
                    const hours = parseInt(parts[0], 10)
                    const mins = parts[1] ? parseInt(parts[1].replace('分', ''), 10) : 0
                    minutes = (isNaN(hours) ? 0 : hours * 60) + (isNaN(mins) ? 0 : mins)
                }

                return isNaN(minutes) ? 0 : minutes
            }

            // 生成饼图数据
            function generatePieChartData(paths) {
                const totalTime = calculateTotalTime(paths)
                const data = {}
                paths.forEach((path) => {
                    if (path.type in data) {
                        data[path.type] += parseTime(path.past)
                    } else {
                        data[path.type] = parseTime(path.past)
                    }
                })
                const pieData = []
                for (const type in data) {
                    const percentage = ((data[type] / totalTime) * 100).toFixed(2)
                    pieData.push({ name: type, value: percentage })
                }
                return pieData
            }

            // 初始化 ECharts
            const chartContainer = document.getElementById('chart-container')
            const chart = echarts.init(chartContainer)

            // 生成饼图
            chart.setOption({
                title: {
                    text: '时间分布',
                    left: 'center',
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b} : {c}%',
                },
                series: [
                    {
                        name: '时间百分比',
                        type: 'pie',
                        radius: '55%',
                        center: ['50%', '50%'],
                        data: generatePieChartData(paths),
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)',
                            },
                        },
                        label: {
                            show: true,
                            formatter: '{b} : {d}%',
                        },
                    },
                ],
            })
        }
        // 删除发车时间
        function deleteEditStartTime(index) {
            const startInputs = document.getElementById('editStartInputs')
            startInputs.children[index].remove()
        }
        // 删除途径时间
        function deleteEditWayTime(index) {
            const wayInputs = document.getElementById('editWayInputs')
            wayInputs.children[index * 3].remove() // 删除起始时间
            wayInputs.children[index * 3].remove() // 删除分隔符
            wayInputs.children[index * 3].remove() // 删除结束时间
        }
        // 显示新增窗口
        function openModal() {
            const modal = document.getElementById('addModal')
            modal.classList.remove('hidden')
        }

        // 关闭新增窗口
        function closeModal() {
            const modal = document.getElementById('addModal')
            modal.classList.add('hidden')
        }
        function refresh() {
            saveDataToLocalStorage()
            render()
            renderTable()
            renderWayContainer()
            generateConfigUI()
            // 生成饼图
            generatePieChart(updatedPaths)
        }
    </script>
</body>

</html>
